<template>
  <div class="container">
    <section id="intro">
      <div id="intro-info">
        <h1>Cheng Ling Jie (Jeremy) <span style="font-size:0.7em;">(Êõæ‰ª§Êù∞)</span></h1>
        <h2>PhD, MPH, BSN (Hons), RN</h2>
        <p class="intro-description">
Dr Cheng Ling Jie is a Postdoctoral Fellow at the <a href="https://www.npeu.ox.ac.uk/about/people/ling-jie-cheng-1110">National Perinatal Epidemiology Unit</a>, University of Oxford, supported by the prestigious <a href="https://www.moe.gov.sg/news/press-releases/20240814-28-young-singaporeans-receive-awards-to-pursue-careers-in-academia-and-research">Singapore Teaching and Academic Research Talent (START) Award</a>. He also holds an academic appointment as Senior Tutor at the <a href="https://medicine.nus.edu.sg/nursing/our-people/our-faculty/teaching-faculty/cheng-ling-jie/">Alice Lee Centre for Nursing Studies</a>, Yong Loo Lin School of Medicine, National University of Singapore.
        </p>
        
        <p class="intro-description">
His research focuses on health economics and outcomes research, with the goal of improving healthcare decision-making. He has led or contributed to projects securing over SGD 1.6 million in funding and has published more than 70 peer-reviewed articles. He has also supervised over 30 undergraduate and 8 postgraduate theses.
        </p>
        
        <p class="intro-description">
Internationally, Dr Cheng serves as a <a href="https://systematicreviewsjournal.biomedcentral.com/about/editorial-board">Senior Editor</a> for Systematic Reviews and an <a href="https://link.springer.com/journal/11136/editorial-board">Associate Editor</a> for Quality of Life Research. He is a member of the EuroQol Group Association, ISPOR, ISOQOL, and the PROMIS Health Organization, and a founding member of the EuroQol PhD Network. He is also a regular peer reviewer for leading journals in public health, nursing, and health outcomes research.
        </p>
      </div>

      <div class="intro-img-block">
        <img src="/img/CHENG-LING-JIE_NUS-OAM-9.jpg" alt="Dr Cheng Ling Jie (Jeremy)" />
        
        <div class="social-links-container">
          <div class="social-links">
            <a href="https://www.linkedin.com/in/chenglingjie/" class="social-link linkedin" target="_blank" rel="noopener noreferrer">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"/>
              </svg>
            </a>
            
            <a href="https://www.researchgate.net/profile/Ling-Jie-Cheng?ev=hdr_xprf" class="social-link researchgate" target="_blank" rel="noopener noreferrer">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19.586 0H4.414A4.414 4.414 0 000 4.414v15.172A4.414 4.414 0 004.414 24h15.172A4.414 4.414 0 0024 19.586V4.414A4.414 4.414 0 0019.586 0zM8.707 19.79c-1.297 0-2.274-.702-2.274-1.297 0-.351.351-.702.702-.702.702 0 1.297.351 1.297 1.053 0 .351-.351.946-.351.946s1.648-1.405 1.648-3.243c0-1.892-1.405-3.594-3.594-3.594-1.892 0-3.243 1.351-3.243 3.243 0 1.648 1.297 2.946 2.946 2.946zM15.334 15.5c0 .405-.324.729-.729.729s-.729-.324-.729-.729v-2.7c0-.405.324-.729.729-.729s.729.324.729.729v2.7zm.729-4.374c0 .405-.324.729-.729.729s-.729-.324-.729-.729v-1.458c0-.405.324-.729.729-.729s.729.324.729.729v1.458zm.729-3.24c0 .405-.324.729-.729.729s-.729-.324-.729-.729V6.27c0-.405.324-.729.729-.729s.729.324.729.729v1.616z"/>
              </svg>
            </a>
            
            <a href="https://scholar.google.com/citations?user=IjgLMBkAAAAJ&hl=en" class="social-link scholar" target="_blank" rel="noopener noreferrer">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/>
              </svg>
            </a>
            
            <a href="https://twitter.com/JeremyChengLJ" class="social-link twitter" target="_blank" rel="noopener noreferrer">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
            </a>
          </div>
          
          <div class="contact-link-row">
            <button @click="toggleChatWidget" class="social-link contact">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
              </svg>
              <span>Chat with Dr Cheng</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <section id="education" class="highlight-section">
      <h2>Education & Training</h2>
      <ul class="education-list">
        <li><strong>Postdoctoral Fellowship</strong>, University of Oxford</li>
        <li><strong>PhD in Public Health</strong>, National University of Singapore</li>
        <li><strong>Master of Public Health</strong>, National University of Singapore</li>
        <li><strong>Bachelor of Science (Nursing) (Honours)</strong>, National University of Singapore</li>
      </ul>
    </section>

    <section id="appointments" class="highlight-section appointments">
      <h2>Academic Appointments</h2>
      <ul class="appointment-list">
        <li><strong>Postdoctoral Fellow (NUS-OPF)</strong> [2024-Present], University of Oxford</li>
        <li><strong>Senior Tutor (NUS-OPF)</strong> [2024-Present], National University of Singapore</li>
        <li><strong>Research Associate</strong> [2021-2024], National University of Singapore</li>
        <li><strong>PhD Candidate</strong> [2021-2024], National University of Singapore</li>
      </ul>
    </section>

    <section id="contact">
      <h2>Contact & Locations</h2>
      <div class="two-cols">
        <div class="contact-location">
          <strong>National Perinatal Epidemiology Unit (NPEU)</strong><br>
          Nuffield Department of Population Health<br>
          University of Oxford<br>
          Old Road Campus<br>
          Oxford OX3 7LF<br>
          United Kingdom
        </div>
        <div class="contact-location">
          <strong>Alice Lee Centre for Nursing Studies (NUS Nursing)</strong><br>
          Yong Loo Lin School of Medicine<br>
          Centre for Translational Medicine<br>
          Block MD6, Level 5<br>
          14 Medical Drive<br>
          Singapore 117599
        </div>
      </div>
    </section>

    <!-- Chat Widget -->
    <div v-if="showChatWidget" class="chat-widget-overlay" @click="closeChatWidget">
      <div class="chat-widget" @click.stop>
        <div class="chat-header">
          <div class="chat-header-info">
            <div class="chat-avatar">
              <img src="/img/CHENG-LING-JIE_NUS-OAM-9.jpg" alt="Dr Cheng">
            </div>
            <div class="chat-header-text">
              <h3>Dr Cheng Ling Jie</h3>
              <span class="chat-status">{{ isOnline ? 'Online' : 'Leave a message' }}</span>
            </div>
          </div>
          <div class="chat-header-actions">
            <button @click="showAdminPanel" class="mode-toggle" title="Admin Panel (Dr Cheng only)" style="opacity: 0.3;">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM19 7V6C19 3.8 17.2 2 15 2H9C6.8 2 5 3.8 5 6V7H3V9H5V19C5 20.1 5.9 21 7 21H17C18.1 21 19 20.1 19 19V9H21V7H19ZM17 19H7V9H17V19Z"/>
              </svg>
            </button>
            <button @click="toggleMode" class="mode-toggle" :title="currentMode === 'chat' ? 'Switch to Message' : 'Switch to Chat'">
              <svg v-if="currentMode === 'chat'" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
              <svg v-else viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
              </svg>
            </button>
            <button @click="closeChatWidget" class="close-btn">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Chat Mode -->
        <div v-if="currentMode === 'chat'" class="chat-content">
          <!-- ËÆøÂÆ¢‰ø°ÊÅØÊî∂ÈõÜ -->
          <div v-if="showContactInfo" class="visitor-info-form">
            <div class="form-header">
              <h4>Before we continue...</h4>
              <p>Please provide your contact info so Dr Cheng can follow up with you directly:</p>
            </div>
            <div class="form-row">
              <input 
                v-model="visitorInfo.name" 
                placeholder="Your name" 
                class="visitor-input"
              >
              <input 
                v-model="visitorInfo.email" 
                placeholder="Your email" 
                type="email"
                class="visitor-input"
              >
            </div>
            <div class="form-actions">
              <button @click="collectVisitorInfo" class="collect-btn" :disabled="!visitorInfo.name.trim() || !visitorInfo.email.trim()">
                Continue Chat
              </button>
              <button @click="skipContactInfo" class="skip-btn">Skip for now</button>
            </div>
          </div>

          <div class="chat-messages" ref="chatMessages">
            <div v-for="message in messages" :key="message.id" class="message" :class="{ 'user': message.sender === 'user', 'assistant': message.sender === 'assistant' }">
              <div class="message-content">
                <p>{{ message.text }}</p>
                <span class="message-time">{{ message.time }}</span>
              </div>
            </div>
            <div v-if="isTyping" class="message assistant">
              <div class="message-content">
                <div class="typing-indicator">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
            </div>
          </div>
          <div class="chat-input-area">
            <!-- Êìç‰ΩúÊåâÈíÆ -->
            <div class="chat-actions" v-if="messages.length > 2">
              <button @click="requestHumanChat" class="action-btn human-btn">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V19A2 2 0 0 0 5 21H19A2 2 0 0 0 21 19V9Z"/>
                </svg>
                Connect with Dr Cheng
              </button>
              <button @click="sendChatHistory" class="action-btn email-btn" v-if="visitorInfo.collected">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
                Email this chat
              </button>
            </div>
            
            <div class="chat-input-container">
              <input 
                v-model="currentMessage" 
                @keyup.enter="sendMessage"
                @input="handleInput"
                placeholder="Type your message..." 
                class="chat-input"
                :disabled="isTyping"
                ref="chatInput"
              >
              <button @click="sendMessage" class="send-btn" :disabled="!currentMessage.trim() || isTyping">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Message Mode -->
        <div v-else class="message-form">
          <div class="form-group">
            <label for="name">Name *</label>
            <input 
              v-model="messageForm.name" 
              type="text" 
              id="name" 
              placeholder="Your full name"
              required
            >
          </div>
          <div class="form-group">
            <label for="email">Email *</label>
            <input 
              v-model="messageForm.email" 
              type="email" 
              id="email" 
              placeholder="your.email@example.com"
              required
            >
          </div>
          <div class="form-group">
            <label for="subject">Subject *</label>
            <input 
              v-model="messageForm.subject" 
              type="text" 
              id="subject" 
              placeholder="Research collaboration, academic inquiry, etc."
              required
            >
          </div>
          <div class="form-group">
            <label for="message">Message *</label>
            <textarea 
              v-model="messageForm.message" 
              id="message" 
              rows="4" 
              placeholder="Please describe your inquiry in detail..."
              required
            ></textarea>
          </div>
          <button @click="sendFormMessage" class="submit-btn" :disabled="!isFormValid || isSubmitting">
            <span v-if="isSubmitting">Sending...</span>
            <span v-else>Send Message</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Floating Chat Button -->
    <button v-if="!showChatWidget" @click="toggleChatWidget" class="floating-chat-btn">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
      </svg>
      <div class="chat-notification" v-if="hasNewMessage">1</div>
    </button>
  </div>
</template>

<script>
export default {
  name: 'Home',
  data() {
    return {
      showChatWidget: false,
      currentMode: 'chat', // 'chat' or 'message'
      isOnline: true,
      isTyping: false,
      isSubmitting: false,
      hasNewMessage: false,
      currentMessage: '',
      showContactInfo: false, // ÊòØÂê¶ÊòæÁ§∫ËÅîÁ≥ª‰ø°ÊÅØÊî∂ÈõÜ
      visitorInfo: {
        name: '',
        email: '',
        collected: false
      },
      messages: [
        {
          id: 1,
          sender: 'assistant',
          text: 'Hello! I\'m Dr Cheng\'s AI assistant. How can I help you today? I can answer questions about research, collaborations, or help you get in touch. üòä',
          time: this.getCurrentTime()
        }
      ],
      messageForm: {
        name: '',
        email: '',
        subject: '',
        message: ''
      },
      messageIdCounter: 2,
      chatHistory: [] // Â≠òÂÇ®ÂÆåÊï¥ÁöÑËÅäÂ§©ËÆ∞ÂΩï
    }
  },
  computed: {
    isFormValid() {
      return this.messageForm.name.trim() && 
             this.messageForm.email.trim() && 
             this.messageForm.subject.trim() && 
             this.messageForm.message.trim();
    }
  },
  methods: {
    toggleChatWidget() {
      this.showChatWidget = !this.showChatWidget;
      if (this.showChatWidget) {
        this.hasNewMessage = false;
        this.$nextTick(() => {
          this.scrollToBottom();
          // Ëá™Âä®ËÅöÁÑ¶Âà∞ËæìÂÖ•Ê°Ü
          if (this.$refs.chatInput) {
            this.$refs.chatInput.focus();
          }
        });
      }
    },
    closeChatWidget() {
      this.showChatWidget = false;
    },
    toggleMode() {
      this.currentMode = this.currentMode === 'chat' ? 'message' : 'chat';
      if (this.currentMode === 'chat') {
        this.$nextTick(() => {
          if (this.$refs.chatInput) {
            this.$refs.chatInput.focus();
          }
        });
      }
    },
    getCurrentTime() {
      return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    },
    async sendMessage() {
      if (!this.currentMessage.trim() || this.isTyping) return;

      // Á¨¨3Êù°Ê∂àÊÅØÂêéÊèêÁ§∫Êî∂ÈõÜËÅîÁ≥ª‰ø°ÊÅØ
      if (this.messages.length === 3 && !this.visitorInfo.collected) {
        this.showContactInfo = true;
        return;
      }

      // Add user message
      const userMessage = {
        id: this.messageIdCounter++,
        sender: 'user',
        text: this.currentMessage,
        time: this.getCurrentTime()
      };
      this.messages.push(userMessage);
      
      // ‰øùÂ≠òÂà∞ËÅäÂ§©ÂéÜÂè≤
      this.chatHistory.push({
        type: 'user_message',
        content: this.currentMessage,
        timestamp: new Date().toISOString(),
        visitor: this.visitorInfo.collected ? this.visitorInfo : null
      });
      
      const messageToSend = this.currentMessage;
      this.currentMessage = '';
      
      this.$nextTick(() => {
        this.scrollToBottom();
      });

      // Simulate typing
      this.isTyping = true;
      
      try {
        // ÊûÑÂª∫Êõ¥Êô∫ËÉΩÁöÑÊèêÁ§∫ËØçÔºåÂåÖÂê´ÂØπËØùÂéÜÂè≤
        const conversationHistory = this.messages.slice(-5).map(msg => 
          `${msg.sender === 'user' ? 'User' : 'Assistant'}: ${msg.text}`
        ).join('\n');
        
        // Using Claude API through window.claude.complete
        const response = await window.claude.complete(`You are Dr Cheng Ling Jie's AI assistant helping visitors on his academic website. You should provide helpful, contextual responses based on the conversation.

Context about Dr Cheng:
- Postdoctoral Fellow at National Perinatal Epidemiology Unit, University of Oxford
- Senior Tutor at Alice Lee Centre for Nursing Studies, National University of Singapore  
- PhD, MPH, BSN (Hons), RN
- Research focus: health economics and outcomes research, healthcare decision-making
- Led projects securing over SGD 1.6 million in funding
- Published 70+ peer-reviewed articles
- Supervised 30+ undergraduate and 8 postgraduate theses
- Senior Editor for Systematic Reviews journal, Associate Editor for Quality of Life Research
- Member of EuroQol Group, ISPOR, ISOQOL, PROMIS Health Organization
- Expert in health economics, quality of life research, systematic reviews

Recent conversation context:
${conversationHistory}

Current user message: "${messageToSend}"

Guidelines:
- Respond naturally and conversationally to the specific message
- If asked about research topics, provide specific details about Dr Cheng's work
- If asked about collaboration, explain his areas of expertise and suggest next steps
- If the message is very short/unclear, ask clarifying questions
- Keep responses helpful but concise (2-3 sentences max)
- If appropriate, suggest using "Connect with Dr Cheng" button for detailed discussions
- Be friendly and professional

Respond only with your reply, no extra formatting:`);

        // Add assistant response
        const assistantMessage = {
          id: this.messageIdCounter++,
          sender: 'assistant',
          text: response,
          time: this.getCurrentTime()
        };
        this.messages.push(assistantMessage);
        
        // ‰øùÂ≠òÂä©ÊâãÂõûÂ§çÂà∞ËÅäÂ§©ÂéÜÂè≤
        this.chatHistory.push({
          type: 'assistant_response',
          content: response,
          timestamp: new Date().toISOString()
        });
        
      } catch (error) {
        // Êô∫ËÉΩÁöÑÂ§áÁî®ÂõûÂ§çÔºåÂü∫‰∫éÊ∂àÊÅØÂÜÖÂÆπ
        let fallbackResponse = this.generateFallbackResponse(messageToSend);
        
        const assistantMessage = {
          id: this.messageIdCounter++,
          sender: 'assistant',
          text: fallbackResponse,
          time: this.getCurrentTime()
        };
        this.messages.push(assistantMessage);
      }
      
      this.isTyping = false;
      this.$nextTick(() => {
        this.scrollToBottom();
      });
    },
    async sendFormMessage() {
      if (!this.isFormValid || this.isSubmitting) return;
      
      this.isSubmitting = true;
      
      // Simulate sending email
      try {
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Reset form
        this.messageForm = {
          name: '',
          email: '',
          subject: '',
          message: ''
        };
        
        // Show success message
        alert('Message sent successfully! Dr Cheng will get back to you soon.');
        this.closeChatWidget();
        
      } catch (error) {
        alert('Failed to send message. Please try again or email directly.');
      } finally {
        this.isSubmitting = false;
      }
    },
    scrollToBottom() {
      if (this.$refs.chatMessages) {
        this.$refs.chatMessages.scrollTop = this.$refs.chatMessages.scrollHeight;
      }
    },
    handleInput() {
      // Could add typing indicators or other real-time features
    },
    
    collectVisitorInfo() {
      if (!this.visitorInfo.name.trim() || !this.visitorInfo.email.trim()) return;
      
      this.visitorInfo.collected = true;
      this.showContactInfo = false;
      
      // ËÆ∞ÂΩïËÆøÂÆ¢‰ø°ÊÅØ
      this.chatHistory.push({
        type: 'visitor_info',
        content: {
          name: this.visitorInfo.name,
          email: this.visitorInfo.email
        },
        timestamp: new Date().toISOString()
      });
      
      // Ê∑ªÂä†Á°ÆËÆ§Ê∂àÊÅØ
      const confirmMessage = {
        id: this.messageIdCounter++,
        sender: 'assistant',
        text: `Thank you, ${this.visitorInfo.name}! I've noted your contact information. Dr Cheng will be able to follow up with you directly at ${this.visitorInfo.email}. How else can I help you today?`,
        time: this.getCurrentTime()
      };
      this.messages.push(confirmMessage);
      
      // ÂèëÈÄÅÈÄöÁü•ÁªôDr Cheng
      this.notifyDrCheng('visitor_info_collected');
      
      this.$nextTick(() => {
        this.scrollToBottom();
        if (this.$refs.chatInput) {
          this.$refs.chatInput.focus();
        }
      });
    },
    
    skipContactInfo() {
      this.showContactInfo = false;
      
      const skipMessage = {
        id: this.messageIdCounter++,
        sender: 'assistant',
        text: 'No problem! You can continue our conversation. If you need Dr Cheng to follow up with you later, just click "Connect with Dr Cheng" button below.',
        time: this.getCurrentTime()
      };
      this.messages.push(skipMessage);
      
      this.$nextTick(() => {
        this.scrollToBottom();
        if (this.$refs.chatInput) {
          this.$refs.chatInput.focus();
        }
      });
    },
    
    async requestHumanChat() {
      // Â¶ÇÊûúÊ≤°ÊúâÊî∂ÈõÜËÅîÁ≥ª‰ø°ÊÅØÔºåÂÖàÊî∂ÈõÜ
      if (!this.visitorInfo.collected) {
        this.showContactInfo = true;
        return;
      }
      
      try {
        // ÂèëÈÄÅÂÆåÊï¥ËÅäÂ§©ËÆ∞ÂΩïÁªôDr Cheng
        await this.sendNotificationToDrCheng({
          type: 'human_chat_request',
          visitor: this.visitorInfo,
          chatHistory: this.chatHistory,
          messages: this.messages,
          timestamp: new Date().toISOString()
        });
        
        const notifyMessage = {
          id: this.messageIdCounter++,
          sender: 'assistant',
          text: `I've notified Dr Cheng about your request to chat directly. He will reach out to you at ${this.visitorInfo.email} soon. In the meantime, feel free to continue our conversation or leave a detailed message using the message form.`,
          time: this.getCurrentTime()
        };
        this.messages.push(notifyMessage);
        
        alert('Dr Cheng has been notified and will contact you directly!');
        
      } catch (error) {
        alert('Unable to send notification. Please try using the message form instead.');
      }
      
      this.$nextTick(() => {
        this.scrollToBottom();
      });
    },
    
    async sendChatHistory() {
      if (!this.visitorInfo.collected) {
        alert('Please provide your contact information first.');
        return;
      }
      
      try {
        // ÁîüÊàêËÅäÂ§©ËÆ∞ÂΩïÊëòË¶Å
        const chatSummary = this.generateChatSummary();
        
        // ÂèëÈÄÅÈÇÆ‰ª∂ÁªôËÆøÂÆ¢ÂíåDr Cheng
        await this.sendEmailWithChatHistory(chatSummary);
        
        const confirmMessage = {
          id: this.messageIdCounter++,
          sender: 'assistant',
          text: `I've emailed a copy of our conversation to both you (${this.visitorInfo.email}) and Dr Cheng. You should receive it shortly.`,
          time: this.getCurrentTime()
        };
        this.messages.push(confirmMessage);
        
        alert('Chat history has been emailed to both parties!');
        
      } catch (error) {
        alert('Unable to send email. Please try copying the conversation manually.');
      }
      
      this.$nextTick(() => {
        this.scrollToBottom();
      });
    },
    
    generateChatSummary() {
      const summary = {
        visitor: this.visitorInfo,
        startTime: this.messages[0].time,
        endTime: this.getCurrentTime(),
        messageCount: this.messages.length,
        conversation: this.messages.map(msg => ({
          sender: msg.sender,
          message: msg.text,
          time: msg.time
        }))
      };
      return summary;
    },,
    
    async sendNotificationToDrCheng(data) {
      // ÂÆûÈôÖÂèØÁî®ÁöÑÈÄöÁü•ÊñπÂºè
      
      // ÊñπÂºè1: ÁîüÊàêmailtoÈìæÊé•ÔºåËá™Âä®ÊâìÂºÄÈÇÆ‰ª∂ÂÆ¢Êà∑Á´Ø
      const emailSubject = encodeURIComponent(`üîî Website Chat: ${data.type === 'human_chat_request' ? 'Direct Chat Request' : 'New Visitor'} from ${data.visitor?.name || 'Anonymous'}`);
      const emailBody = encodeURIComponent(this.formatEmailNotification(data));
      const mailtoLink = `mailto:lingjie.cheng@npeu.ox.ac.uk?subject=${emailSubject}&body=${emailBody}`;
      
      // ÊñπÂºè2: Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
      try {
        await navigator.clipboard.writeText(this.formatEmailNotification(data));
        console.log('‚úÖ Chat details copied to clipboard');
      } catch (error) {
        console.log('Clipboard not available');
      }
      
      // ÊñπÂºè3: Webhook Âà∞ Slack/Discord/Teams (Â¶ÇÊûúÈÖçÁΩÆ‰∫Ü)
      try {
        // ‰Ω†ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†‰Ω†ÁöÑ Slack Webhook URL
        const webhookUrl = ''; // 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL';
        
        if (webhookUrl) {
          const slackMessage = {
            text: "üîî New website visitor interaction",
            attachments: [{
              color: data.type === 'human_chat_request' ? 'warning' : 'good',
              fields: [
                {
                  title: "Visitor",
                  value: data.visitor ? `${data.visitor.name} (${data.visitor.email})` : 'Anonymous',
                  short: true
                },
                {
                  title: "Type",
                  value: data.type === 'human_chat_request' ? 'ü§ù Direct Chat Request' : 'üìù Contact Info Collected',
                  short: true
                },
                {
                  title: "Messages",
                  value: `${data.messages?.length || data.chatHistory?.length || 0} exchanged`,
                  short: true
                },
                {
                  title: "Time",
                  value: new Date().toLocaleString(),
                  short: true
                }
              ],
              text: data.chatHistory ? 
                `Recent conversation:\n${data.chatHistory.slice(-3).map(msg => 
                  `${msg.type === 'user_message' ? 'üë§' : 'ü§ñ'} ${msg.content}`
                ).join('\n')}` : ''
            }]
          };
          
          await fetch(webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(slackMessage)
          });
          console.log('‚úÖ Slack notification sent');
        }
      } catch (error) {
        console.log('‚ùå Webhook notification failed:', error);
      }
      
      // ÊñπÂºè4: ‰ΩøÁî®Á¨¨‰∏âÊñπÈÇÆ‰ª∂ÊúçÂä° (EmailJS)
      try {
        // Â¶ÇÊûú‰Ω†ÈÖçÁΩÆ‰∫Ü EmailJSÔºåÂèØ‰ª•ÂèñÊ∂àÊ≥®Èáä‰ª•‰∏ã‰ª£Á†Å
        /*
        const emailData = {
          to_email: 'lingjie.cheng@npeu.ox.ac.uk',
          from_name: data.visitor?.name || 'Website Visitor',
          from_email: data.visitor?.email || 'no-reply@valuelab.com',
          subject: `Website Chat: ${data.type}`,
          message: this.formatEmailNotification(data)
        };
        
        await emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', emailData, 'YOUR_PUBLIC_KEY');
        console.log('‚úÖ EmailJS notification sent');
        */
      } catch (error) {
        console.log('‚ùå EmailJS notification failed:', error);
      }
      
      // ÊñπÂºè5: Ëá™Âä®ÊâìÂºÄÈÇÆ‰ª∂ÂÆ¢Êà∑Á´Ø
      window.open(mailtoLink, '_blank');
      
      return true;
    },
    
    async notifyDrCheng(eventType) {
      // ÁÆÄÂçïÁöÑÈÄöÁü•ÔºåÂΩìËÆøÂÆ¢Êèê‰æõËÅîÁ≥ª‰ø°ÊÅØÊó∂
      if (eventType === 'visitor_info_collected') {
        try {
          await this.sendNotificationToDrCheng({
            type: 'visitor_info_collected',
            visitor: this.visitorInfo,
            chatHistory: this.chatHistory,
            timestamp: new Date().toISOString()
          });
        } catch (error) {
          console.log('Notification failed:', error);
        }
      }
    },,
    
    // Ê∑ªÂä†ÁÆ°ÁêÜÂëòÊü•ÁúãÂäüËÉΩÔºàÁî®‰∫éÊµãËØïÂíåË∞ÉËØïÔºâ
    showAdminPanel() {
      if (confirm('Show admin panel? (For Dr Cheng only)')) {
        const adminData = {
          totalChats: this.messages.length,
          visitorInfo: this.visitorInfo,
          chatHistory: this.chatHistory,
          lastActive: new Date().toISOString()
        };
        
        console.log('üìä Admin Panel Data:', adminData);
        
        // ÊòæÁ§∫ÁÆ°ÁêÜ‰ø°ÊÅØ
        alert(`Chat Admin Info:
üìß Visitor: ${this.visitorInfo.name || 'Anonymous'} (${this.visitorInfo.email || 'No email'})
üí¨ Messages: ${this.messages.length}
üìù History entries: ${this.chatHistory.length}
üïê Session started: ${(this.messages[0] && this.messages[0].time) || 'Unknown'}

Check console for detailed logs.`);
      }
    },
    
    formatEmailNotification(data) {
      const visitorName = (data.visitor && data.visitor.name) ? data.visitor.name : 'Anonymous Visitor';
      const visitorEmail = (data.visitor && data.visitor.email) ? data.visitor.email : 'No email provided';
      
      let emailContent = `
üîî NEW WEBSITE VISITOR INTERACTION

Visitor Information:
üë§ Name: ${visitorName}
üìß Email: ${visitorEmail}
üïê Time: ${new Date().toLocaleString()}
üìç Page: VALUE Lab Website Chat

Request Type: ${data.type === 'human_chat_request' ? 'ü§ù DIRECT CHAT REQUEST' : 'üìù Contact Info Collected'}

`;

      if (data.chatHistory && data.chatHistory.length > 0) {
        emailContent += `
üìã CONVERSATION HISTORY:
${data.chatHistory.map(entry => {
  const time = new Date(entry.timestamp).toLocaleTimeString();
  if (entry.type === 'user_message') {
    return `[${time}] üë§ ${visitorName}: ${entry.content}`;
  } else if (entry.type === 'assistant_response') {
    return `[${time}] ü§ñ AI Assistant: ${entry.content}`;
  }
  return '';
}).filter(Boolean).join('\n')}

`;
      }

      if (data.messages && data.messages.length > 1) {
        emailContent += `
üí¨ FULL CHAT MESSAGES:
${data.messages.map(msg => 
  `[${msg.time}] ${msg.sender === 'user' ? 'üë§ ' + visitorName : 'ü§ñ AI Assistant'}: ${msg.text}`
).join('\n')}

`;
      }

      emailContent += `
üìû NEXT STEPS:
${data.type === 'human_chat_request' ? 
  `The visitor has specifically requested to chat with you directly. Please respond to them at: ${visitorEmail}` :
  `The visitor provided their contact information. You may want to follow up about their interests.`
}

---
üìß Reply directly to: ${visitorEmail}
üåê Sent from: VALUE Lab Website Chat System
‚öôÔ∏è To configure notifications: Check the admin panel in the chat widget

This is an automated notification from your website chat system.
      `.trim();
      
      return emailContent;
    }
    
    async sendEmailWithChatHistory(chatSummary) {
      // ÂèëÈÄÅËØ¶ÁªÜÁöÑËÅäÂ§©ËÆ∞ÂΩïÈÇÆ‰ª∂
      const emailContent = `
Dear ${chatSummary.visitor.name},

Thank you for your interest in Dr Cheng's research. Below is a copy of our conversation:

Conversation Summary:
- Started: ${chatSummary.startTime}
- Messages: ${chatSummary.messageCount}
- Your Email: ${chatSummary.visitor.email}

Full Conversation:
${chatSummary.conversation.map(msg => 
  `[${msg.time}] ${msg.sender === 'user' ? chatSummary.visitor.name : 'AI Assistant'}: ${msg.message}`
).join('\n\n')}

Dr Cheng will follow up with you directly at ${chatSummary.visitor.email}.

Best regards,
Dr Cheng's AI Assistant
VALUE Lab - University of Oxford & National University of Singapore
      `.trim();
      
      // ËøôÈáåÈõÜÊàêÈÇÆ‰ª∂ÊúçÂä°ÂèëÈÄÅÁªôËÆøÂÆ¢ÂíåDr Cheng
      console.log('Email content generated:', emailContent);
    },,
    
    generateFallbackResponse(message) {
      const lowerMsg = message.toLowerCase();
      
      // Ê£ÄÊµãÂ∏∏ËßÅÂÖ≥ÈîÆËØçÂπ∂ÁªôÂá∫Áõ∏Â∫îÂõûÂ§ç
      if (lowerMsg.includes('research') || lowerMsg.includes('study')) {
        return "Dr Cheng's research focuses on health economics and outcomes research. He's particularly interested in improving healthcare decision-making through evidence-based approaches. Would you like to know more about any specific research area?";
      } else if (lowerMsg.includes('collaboration') || lowerMsg.includes('collaborate')) {
        return "Dr Cheng is always open to research collaborations! His areas include health economics, quality of life research, and systematic reviews. Click 'Connect with Dr Cheng' to discuss potential partnerships.";
      } else if (lowerMsg.includes('phd') || lowerMsg.includes('student') || lowerMsg.includes('supervision')) {
        return "Dr Cheng has supervised over 30 undergraduate and 8 postgraduate students. He's experienced in mentoring research in health economics and nursing. Are you interested in pursuing research under his guidance?";
      } else if (lowerMsg.includes('publication') || lowerMsg.includes('paper') || lowerMsg.includes('article')) {
        return "Dr Cheng has published more than 70 peer-reviewed articles in health economics and outcomes research. He also serves as Senior Editor for Systematic Reviews journal. Looking for specific publications?";
      } else if (lowerMsg.includes('contact') || lowerMsg.includes('email') || lowerMsg.includes('reach')) {
        return "You can reach Dr Cheng at lingjie.cheng@npeu.ox.ac.uk or use the 'Connect with Dr Cheng' button below for priority contact. What would you like to discuss with him?";
      } else if (lowerMsg.length <= 3) {
        return "I'd be happy to help! Could you tell me more about what you're interested in regarding Dr Cheng's work? Are you looking for research collaboration, publication information, or something else?";
      } else {
        return `Thanks for your message! I'd be happy to help you learn more about Dr Cheng's work in health economics and outcomes research. Could you elaborate on what specific information you're looking for?`;
      }
    },
  },
  mounted() {
    // Simulate receiving a message after 5 seconds
    setTimeout(() => {
      if (!this.showChatWidget) {
        this.hasNewMessage = true;
      }
    }, 5000);
  }
}
</script>

<style scoped>
/* Original styles remain the same */
#intro {
  display: flex;
  align-items: center;
  gap: 40px;
  margin-bottom: 40px;
  min-height: 600px;
}

#intro-info {
  flex: 1.2;
  min-width: 0;
}

#intro-info h1 {
  font-size: 2.2em;
  margin-bottom: 12px;
  color: var(--primary-blue);
  line-height: 1.2;
}

#intro-info h2 {
  font-size: 1.2em;
  color: var(--text-medium);
  margin-bottom: 24px;
  font-weight: 500;
}

.intro-description {
  font-size: 1.05em;
  color: var(--text-dark);
  line-height: 1.7;
  margin-bottom: 18px;
  text-align: justify;
}

.intro-description a {
  color: var(--primary-blue);
}

.intro-img-block {
  flex: 0 0 380px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 20px;
}

.intro-img-block img {
  width: 380px;
  height: 480px;
  object-fit: cover;
  object-position: center 20%;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(21, 76, 121, 0.15);
  border: 4px solid #e3e9f1;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.intro-img-block img:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 40px rgba(21, 76, 121, 0.2);
}

.social-links-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
  width: 100%;
  max-width: 420px;
}

.social-links {
  display: flex;
  gap: 8px;
  flex-wrap: nowrap;
  justify-content: center;
  width: 100%;
}

.contact-link-row {
  display: flex;
  justify-content: center;
  width: 100%;
}

.social-link {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: white;
  border: 2px solid #e3e9f1;
  border-radius: 20px;
  text-decoration: none;
  font-size: 0.85em;
  font-weight: 500;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(21, 76, 121, 0.08);
  justify-content: center;
  min-width: 0;
  cursor: pointer;
}

.social-links .social-link {
  flex: 1;
  padding: 8px 10px;
  font-size: 0.8em;
}

.contact-link-row .social-link {
  padding: 10px 16px;
  font-size: 0.9em;
  min-width: 180px;
}

.social-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(21, 76, 121, 0.15);
}

.social-link svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

.social-links .social-link svg {
  width: 14px;
  height: 14px;
}

.social-link span {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.social-link.linkedin {
  color: #0077b5;
  border-color: #0077b5;
}

.social-link.linkedin:hover {
  background: #0077b5;
  color: white;
}

.social-link.researchgate {
  color: #00d0b6;
  border-color: #00d0b6;
}

.social-link.researchgate:hover {
  background: #00d0b6;
  color: white;
}

.social-link.scholar {
  color: #4285f4;
  border-color: #4285f4;
}

.social-link.scholar:hover {
  background: #4285f4;
  color: white;
}

.social-link.twitter {
  color: #1da1f2;
  border-color: #1da1f2;
}

.social-link.twitter:hover {
  background: #1da1f2;
  color: white;
}

.social-link.contact {
  color: var(--primary-blue);
  border-color: var(--primary-blue);
}

.social-link.contact:hover {
  background: var(--primary-blue);
  color: white;
}

h2 {
  color: var(--primary-blue);
  font-size: 1.25em;
  margin-bottom: 10px;
  border-left: 5px solid var(--primary-orange);
  padding-left: 10px;
}

.highlight-section {
  background: #f0f7fe;
  border-radius: 12px;
  padding: 28px 24px 20px 24px;
  margin-bottom: 36px;
  box-shadow: 0 2px 8px rgba(21, 76, 121, 0.06);
}

.highlight-section.appointments {
  background: #fef7e6;
}

.education-list,
.appointment-list {
  margin-left: 18px;
  margin-bottom: 10px;
}

.education-list li,
.appointment-list li {
  margin-bottom: 8px;
  line-height: 1.5;
}

.two-cols {
  display: flex;
  gap: 40px;
  flex-wrap: wrap;
}

.two-cols > div {
  flex: 1 1 300px;
  min-width: 250px;
}

.contact-location {
  background: var(--background-light);
  padding: 20px;
  border-radius: 10px;
  border-left: 4px solid var(--primary-blue);
  line-height: 1.6;
}

/* Visitor Info Form Styles */
.visitor-info-form {
  background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
  padding: 20px;
  margin: 20px;
  border-radius: 12px;
  border: 2px solid #e3e9f1;
}

.form-header h4 {
  margin: 0 0 8px 0;
  color: #154c79;
  font-size: 1.1em;
}

.form-header p {
  margin: 0 0 16px 0;
  color: #666;
  font-size: 0.9em;
  line-height: 1.4;
}

.form-row {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
}

.visitor-input {
  flex: 1;
  padding: 10px 14px;
  border: 2px solid #e1e5e9;
  border-radius: 8px;
  font-size: 0.9em;
  outline: none;
  transition: border-color 0.2s;
}

.visitor-input:focus {
  border-color: #154c79;
}

.form-actions {
  display: flex;
  gap: 10px;
}

.collect-btn,
.skip-btn {
  padding: 10px 16px;
  border: none;
  border-radius: 8px;
  font-size: 0.9em;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.collect-btn {
  background: #154c79;
  color: white;
  flex: 1;
}

.collect-btn:hover:not(:disabled) {
  background: #1e5a8a;
}

.collect-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.skip-btn {
  background: #f1f3f5;
  color: #666;
  border: 1px solid #ddd;
}

.skip-btn:hover {
  background: #e9ecef;
}

/* Chat Actions Styles */
.chat-actions {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  padding: 0 4px;
}

.action-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background: white;
  border: 2px solid #e1e5e9;
  border-radius: 20px;
  font-size: 0.8em;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  flex: 1;
  justify-content: center;
}

.action-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(21, 76, 121, 0.1);
}

.action-btn svg {
  width: 14px;
  height: 14px;
  flex-shrink: 0;
}

.human-btn {
  color: #28a745;
  border-color: #28a745;
}

.human-btn:hover {
  background: #28a745;
  color: white;
}

.email-btn {
  color: #17a2b8;
  border-color: #17a2b8;
}

.email-btn:hover {
  background: #17a2b8;
  color: white;
}
.chat-widget-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  padding: 20px;
}

.chat-widget {
  width: 400px;
  max-width: 90vw;
  height: 600px;
  max-height: 80vh;
  min-height: 500px; /* Á°Æ‰øùÊúÄÂ∞èÈ´òÂ∫¶ */
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.chat-header {
  background: linear-gradient(135deg, #154c79 0%, #1e5a8a 100%);
  color: white;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.chat-header-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.chat-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.chat-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.chat-header-text h3 {
  margin: 0;
  font-size: 1em;
  font-weight: 600;
}

.chat-status {
  font-size: 0.8em;
  opacity: 0.9;
}

.chat-header-actions {
  display: flex;
  gap: 8px;
}

.mode-toggle,
.close-btn {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: white;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.2s;
}

.mode-toggle:hover,
.close-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.mode-toggle svg,
.close-btn svg {
  width: 16px;
  height: 16px;
}

.chat-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 0; /* Á°Æ‰øùflexÂ∏ÉÂ±ÄÊ≠£Â∏∏Â∑•‰Ωú */
}

.chat-messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 16px;
  min-height: 0; /* Á°Æ‰øùÂèØ‰ª•ÊªöÂä® */
}

.message {
  display: flex;
}

.message.user {
  justify-content: flex-end;
}

.message.assistant {
  justify-content: flex-start;
}

.message-content {
  max-width: 80%;
  padding: 12px 16px;
  border-radius: 18px;
  position: relative;
}

.message.user .message-content {
  background: #154c79;
  color: white;
  border-bottom-right-radius: 4px;
}

.message.assistant .message-content {
  background: #f1f3f5;
  color: #333;
  border-bottom-left-radius: 4px;
}

.message-content p {
  margin: 0;
  line-height: 1.4;
}

.message-time {
  font-size: 0.7em;
  opacity: 0.7;
  display: block;
  margin-top: 4px;
}

.typing-indicator {
  display: flex;
  gap: 4px;
  align-items: center;
}

.typing-indicator span {
  width: 6px;
  height: 6px;
  background: #999;
  border-radius: 50%;
  animation: typing 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) {
  animation-delay: -0.32s;
}

.typing-indicator span:nth-child(2) {
  animation-delay: -0.16s;
}

@keyframes typing {
  0%, 80%, 100% {
    transform: scale(0);
    opacity: 0.5;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}

.chat-input-area {
  padding: 16px 20px 20px 20px;
  border-top: 1px solid #e1e5e9;
  background: #f8f9fa;
  flex-shrink: 0; /* Èò≤Ê≠¢Ë¢´ÂéãÁº© */
}

.chat-input-container {
  display: flex;
  gap: 12px;
  align-items: center;
  min-height: 56px; /* Á°Æ‰øùËæìÂÖ•ÂÆπÂô®ÊúâË∂≥Â§üÈ´òÂ∫¶ */
}

.chat-input {
  flex: 1;
  padding: 12px 16px;
  border: 2px solid #e1e5e9;
  border-radius: 25px;
  outline: none;
  font-size: 0.9em;
  transition: border-color 0.2s;
}

.chat-input:focus {
  border-color: #154c79;
}

.chat-input:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.send-btn {
  width: 40px;
  height: 40px;
  background: #154c79;
  border: none;
  border-radius: 50%;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.send-btn:hover:not(:disabled) {
  background: #1e5a8a;
  transform: scale(1.05);
}

.send-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.send-btn svg {
  width: 18px;
  height: 18px;
}

/* Message Form Styles */
.message-form {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  color: #333;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e1e5e9;
  border-radius: 8px;
  font-size: 0.9em;
  outline: none;
  transition: border-color 0.2s;
  resize: vertical;
}

.form-group input:focus,
.form-group textarea:focus {
  border-color: #154c79;
}

.submit-btn {
  width: 100%;
  padding: 14px;
  background: #154c79;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1em;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s;
}

.submit-btn:hover:not(:disabled) {
  background: #1e5a8a;
}

.submit-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Floating Chat Button */
.floating-chat-btn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  background: #154c79;
  border: none;
  border-radius: 50%;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 8px 24px rgba(21, 76, 121, 0.3);
  transition: all 0.3s ease;
  z-index: 1000;
}

.floating-chat-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 12px 32px rgba(21, 76, 121, 0.4);
}

.floating-chat-btn svg {
  width: 24px;
  height: 24px;
}

.chat-notification {
  position: absolute;
  top: -5px;
  right: -5px;
  width: 20px;
  height: 20px;
  background: #ff4757;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8em;
  font-weight: bold;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

/* Responsive Design */
@media (max-width: 1024px) {
  .intro-img-block {
    flex: 0 0 320px;
  }
  
  .intro-img-block img {
    width: 320px;
    height: 400px;
  }
  
  #intro {
    gap: 30px;
  }
}

@media (max-width: 768px) {
  #intro {
    flex-direction: column;
    gap: 24px;
    align-items: center;
    min-height: auto;
  }

  .intro-img-block {
    flex: none;
    order: -1;
    padding-top: 0;
  }
  
  .intro-img-block img {
    width: 280px;
    height: 350px;
  }

  #intro-info {
    flex: none;
    width: 100%;
  }

  #intro-info h1 {
    text-align: center;
    font-size: 1.8em;
  }

  #intro-info h2 {
    text-align: center;
  }

  .intro-description {
    text-align: left;
  }

  .two-cols {
    flex-direction: column;
    gap: 20px;
  }
  
  .social-links-container {
    gap: 10px;
    max-width: 300px;
  }
  
  .social-links {
    gap: 6px;
  }
  
  .social-links .social-link {
    padding: 6px 8px;
    font-size: 0.75em;
  }
  
  .social-links .social-link svg {
    width: 12px;
    height: 12px;
  }
  
  .contact-link-row .social-link {
    padding: 8px 12px;
    font-size: 0.85em;
    min-width: 160px;
  }

  .chat-widget {
    width: 95vw;
    height: 90vh;
  }

  .floating-chat-btn {
    bottom: 20px;
    right: 20px;
    width: 55px;
    height: 55px;
  }
}

@media (max-width: 480px) {
  .intro-img-block img {
    width: 240px;
    height: 300px;
  }
  
  #intro-info h1 {
    font-size: 1.6em;
  }
  
  .social-links-container {
    max-width: 280px;
  }
  
  .social-links {
    gap: 4px;
  }
  
  .social-links .social-link {
    padding: 5px 6px;
    font-size: 0.7em;
  }
  
  .contact-link-row .social-link {
    padding: 7px 10px;
    font-size: 0.8em;
    min-width: 140px;
  }

  .chat-widget-overlay {
    padding: 10px;
  }

  .chat-widget {
    width: 95vw;
    height: 85vh; /* ÂáèÂ∞ëÈ´òÂ∫¶Á°Æ‰øùËæìÂÖ•Ê°ÜÂèØËßÅ */
  }

  .floating-chat-btn {
    width: 50px;
    height: 50px;
  }

  .form-row {
    flex-direction: column;
    gap: 8px;
  }
  
  .form-actions {
    flex-direction: column;
    gap: 8px;
  }
  
  .chat-actions {
    flex-direction: column;
    gap: 6px;
  }
  
  .action-btn {
    padding: 10px 12px;
    font-size: 0.85em;
  }
}

/* CSS Variables for consistent theming */
:root {
  --primary-blue: #154c79;
  --primary-orange: #ff6b35;
  --text-dark: #2c3e50;
  --text-medium: #576574;
  --background-light: #f8f9fa;
}
</style>
